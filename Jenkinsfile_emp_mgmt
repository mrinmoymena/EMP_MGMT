pipeline {  

  agent any
   
  stages {
    
    stage('Checkout') {
      steps {
        git 'https://github.com/nileshkardile/EMP_MGMT.git'
      }
    }
   
    stage('Build & Create Docker') {
      steps{
        
		sh 'chmod -R 755 ${WORKSPACE}; cd ${WORKSPACE} ; ./mvnw package -Pprod verify jib:dockerBuild'
      }
    }
     stage('Docker Push') {
      steps{
       	script {
               sh '''#!/bin/bash
               #Docker Login
	echo Incedo123 | docker login --username demoapp2020 --password-stdin
	echo "Pushing Docker Image: demoapp2020/emp-mgmt:superhero"
	# Retag docker image
	sudo docker tag jhipster_demo:latest demoapp2020/emp-mgmt:superhero;
	#Docker Push
	sudo docker push demoapp2020/emp-mgmt:superhero
	#Clean up older images
	sudo docker rmi demoapp2020/emp-mgmt:superhero
	sudo docker rmi jhipster_demo:latest
		'''
	}               
      }
    }
  }
}
